# <!-- Powered by BMAD™ Core -->

# Story S2.2: Dependency Modernization

## Status
⚠️ **IMPORTANT** - Not Started

## Story
**As a** developer,  
**I want** modern, supported dependencies and resolved compatibility issues,  
**so that** the project is maintainable, secure, and compatible with current tooling.

## Acceptance Criteria

1. **Replace deprecated Supabase auth helpers** with modern @supabase/ssr package
2. **Update code using old auth helpers API** to use new patterns
3. **Resolve Node.js version compatibility** warnings where possible
4. **Document Node.js version requirements** clearly in project documentation
5. **Verify all functionality works** with updated dependencies
6. **Minimize dependency warnings** and use supported package versions

## Tasks / Subtasks

- [ ] **Replace deprecated Supabase auth helpers** (AC: 1, 2)
  - [ ] Remove `@supabase/auth-helpers-nextjs` dependency
  - [ ] Install and configure `@supabase/ssr` package  
  - [ ] Update auth helper imports throughout codebase
  - [ ] Migrate createServerSupabaseClient to new SSR patterns
  - [ ] Update cookie handling to use new SSR methods
  - [ ] Test that authentication still works with new packages
- [ ] **Address Node.js version compatibility** (AC: 3, 4)
  - [ ] Document supported Node.js versions in README
  - [ ] Update package.json engines field if needed
  - [ ] Evaluate upgrading Jest dependencies to support Node.js v23
  - [ ] Add .nvmrc file for Node version consistency
  - [ ] Test application with recommended Node.js LTS version
- [ ] **Audit and update other dependencies** (AC: 6)
  - [ ] Review all dependency warnings in npm install output
  - [ ] Update packages with available newer versions
  - [ ] Check for security vulnerabilities with npm audit
  - [ ] Update TypeScript and related tooling if beneficial
  - [ ] Verify build tools work with updated dependencies
- [ ] **Test functionality with updated dependencies** (AC: 5)
  - [ ] Run full test suite with updated packages
  - [ ] Test authentication flow with new Supabase SSR
  - [ ] Verify build and development processes work
  - [ ] Test deployment process with updated dependencies
  - [ ] Confirm no regression in application functionality

## Dev Notes

### Current Dependency Issues

**Deprecated Packages:**
```bash
npm warn deprecated @supabase/auth-helpers-shared@0.7.0
npm warn deprecated @supabase/auth-helpers-nextjs@0.10.0
# Recommended: Use @supabase/ssr package instead
```

**Node.js Compatibility Warnings:**
```bash
# Jest packages require: '^18.14.0 || ^20.0.0 || ^22.0.0 || >=24.0.0'
# Current: v23.10.0 (not in supported range)
```

### Migration Strategy

**Supabase Auth Helpers → SSR Migration:**
```typescript
// Old pattern:
import { createServerSupabaseClient } from '@supabase/auth-helpers-nextjs'

// New pattern:
import { createServerClient } from '@supabase/ssr'
```

**Code Updates Required:**
- Update all auth helper imports
- Migrate server-side client creation
- Update cookie handling patterns
- Adjust middleware if using auth helpers there

### Architecture Impact

**Authentication System Changes:**
- Server-side client creation patterns
- Cookie management approaches
- Session handling methods
- Type definitions and interfaces

**Development Workflow:**
- Build process compatibility
- Testing framework compatibility
- Hot reload and development server stability

### Dependencies Analysis

**Critical Dependencies to Update:**
1. **@supabase/ssr**: Replace auth helpers with modern SSR approach
2. **Jest ecosystem**: Address Node.js v23 compatibility if possible
3. **Build tools**: Ensure compatibility with latest versions
4. **TypeScript**: Keep up to date for best developer experience

## Testing

### Test Location Standards
- Dependency tests: Verify functionality after updates
- Integration tests: Ensure auth flow works with new packages
- Build tests: Confirm all processes work with updated deps

### Migration Testing Strategy
```typescript
// Test patterns for dependency updates:
describe('Supabase SSR Migration', () => {
  test('server client creation works', () => {
    // Test new createServerClient approach
  });
  
  test('authentication flow unchanged', () => {
    // Verify login/logout still work
  });
  
  test('cookie handling works', () => {
    // Test session persistence
  });
});
```

### Verification Checklist
- [ ] All tests pass with updated dependencies
- [ ] Build process completes successfully
- [ ] Development server starts without errors
- [ ] Authentication flow works exactly as before
- [ ] No new console warnings or errors
- [ ] Production deployment process unaffected

## Security Considerations

### Dependency Security
- [ ] Run `npm audit` to check for vulnerabilities
- [ ] Verify new packages come from trusted sources
- [ ] Ensure authentication security is maintained
- [ ] Check that new SSR patterns maintain security standards

### Compatibility Testing
- [ ] Test in multiple Node.js versions if possible
- [ ] Verify browser compatibility unchanged
- [ ] Confirm mobile functionality unaffected
- [ ] Test across different deployment environments

## Documentation Updates

### README Updates Required
- [ ] Update Node.js version requirements
- [ ] Document new dependency patterns
- [ ] Update setup instructions if changed
- [ ] Add troubleshooting for common issues

### Development Documentation
- [ ] Update authentication setup docs
- [ ] Document new Supabase SSR patterns
- [ ] Add migration notes for other developers
- [ ] Update CI/CD instructions if affected

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-10 | 1.0 | Initial dependency modernization story | BMad Orchestrator |

## Priority Classification

**Epic**: Project Stabilization  
**Phase**: 2 - Foundation Improvements  
**Priority**: P1 - Important  
**Estimated Effort**: 2-3 hours  
**Assigned Agent**: `devops` specialist  
**Risk**: Medium - Dependency changes can introduce issues  
**Dependencies**: Can run parallel to S2.1