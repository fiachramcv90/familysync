# <!-- Powered by BMAD™ Core -->

# Story 1.1: Project Infrastructure Foundation

## Status
Draft

## Story
**As a** developer,  
**I want** to establish the foundational Next.js PWA and Supabase API integration with build processes and basic routing,  
**so that** the development environment is ready for implementing family coordination features.

## Acceptance Criteria

1. **React PWA project initialized** with TypeScript, Tailwind CSS, and PWA service worker configuration
2. **Node.js/Express API project set up** with TypeScript, basic middleware, and CORS configuration  
3. **SQLite database connection established** with basic connection testing and error handling
4. **Development build processes working** for both frontend and backend with hot reload
5. **Basic project structure documented** in README with setup and run instructions
6. **Environment configuration** working for development, with placeholder for production settings

## Tasks / Subtasks

- [ ] Set up Next.js PWA project with TypeScript and Tailwind CSS (AC: 1)
  - [ ] Initialize Next.js 14.2+ project with TypeScript
  - [ ] Install and configure Tailwind CSS 3.4+
  - [ ] Configure PWA service worker and manifest.json
  - [ ] Set up basic app structure with pages and components directories
- [ ] Configure Supabase integration instead of Node.js/Express API (AC: 2, 3) 
  - [ ] Create Supabase project and configure environment variables
  - [ ] Set up Supabase client configuration for both client and server
  - [ ] Test database connection and basic queries
  - [ ] Configure Row Level Security (RLS) policies for data isolation
- [ ] Set up development environment and build processes (AC: 4)
  - [ ] Configure Next.js development server with hot reload
  - [ ] Set up Turbopack bundler for optimized development builds
  - [ ] Configure TypeScript compilation and type checking
  - [ ] Test PWA functionality in development mode
- [ ] Create basic project documentation (AC: 5)
  - [ ] Update README.md with setup instructions
  - [ ] Document environment variables needed
  - [ ] Add development workflow instructions
- [ ] Configure environment variables and settings (AC: 6)
  - [ ] Create .env.example file with all required variables
  - [ ] Set up development environment configuration
  - [ ] Add placeholder configuration for production deployment
- [ ] Set up basic routing structure 
  - [ ] Configure Next.js App Router for main application routes
  - [ ] Set up protected route patterns for authenticated users
  - [ ] Create basic layout components for consistent navigation

## Dev Notes

### Previous Story Insights
No previous stories exist - this is the foundational story for the project.

### Project Structure Alignment Issues

**CRITICAL ARCHITECTURAL CONFLICT IDENTIFIED:**

The acceptance criteria from the epic file conflicts with the actual technology architecture:

- **Epic AC 2 & 3:** Require "Node.js/Express API project" and "SQLite database connection"
- **Tech Stack Reality:** Next.js 14.2+ with API Routes and Supabase PostgreSQL
- **Project Structure:** Shows monorepo with apps/web and apps/api, but tech stack uses integrated Next.js approach

**Resolution Strategy:**
The implementation will follow the actual tech stack architecture (Next.js + Supabase) rather than the outdated acceptance criteria, as the tech stack document represents the current architectural decisions.

### Architecture Context

**Core Technology Stack** [Source: architecture/tech-stack.md]
- Frontend Framework: Next.js 14.2+ with App Router
- Frontend Language: TypeScript 5.2+
- Database Service: Supabase PostgreSQL with real-time capabilities
- Authentication: Supabase Auth with JWT tokens
- UI Framework: Tailwind CSS 3.4+ for mobile-first responsive design
- State Management: React Query 5.0+ for server state, Zustand 4.4+ for client state
- Build Tool: Next.js with Turbopack bundler
- PWA: Next.js built-in PWA support with service workers

**Project Structure** [Source: architecture/unified-project-structure.md]
Note: The documented structure shows a monorepo setup, but the actual implementation uses Next.js integrated approach:

```
project-root/
├── src/
│   ├── app/                 # Next.js App Router pages
│   ├── components/          # React components
│   │   ├── ui/             # Basic UI components 
│   │   ├── task/           # Task-specific components
│   │   ├── family/         # Family management components
│   │   ├── calendar/       # Weekly dashboard components
│   │   └── layout/         # Layout and navigation
│   ├── lib/                # Utilities and configuration
│   │   ├── supabase.ts     # Supabase client setup
│   │   └── utils.ts        # General utilities
│   └── styles/             # Global styles
├── public/                 # Static assets and PWA files
├── supabase/              # Supabase configuration
└── next.config.js         # Next.js configuration
```

**Database Models** [Source: architecture/data-models.md]
- Family: Core coordination unit with invite codes
- FamilyMember: User accounts within family context
- Task: Main coordination entities with assignment and status tracking
- Event: Time-specific coordination items

**Key Implementation Guidelines** [Source: architecture/coding-standards.md]
- Type Sharing: Define shared types for API consistency
- Environment Variables: Access through config objects, not direct process.env
- Family Data Isolation: All queries must include family ID filtering
- Offline Support: All user actions must work offline-first
- Security Headers: All API responses need proper security headers

### Testing Requirements

**Test Organization** [Source: architecture/testing-strategy.md]
```
tests/
├── __tests__/              # Jest unit tests
│   ├── components/         # Component tests with React Testing Library
│   ├── pages/             # Page integration tests
│   └── lib/               # Utility and service tests
└── e2e/                   # Playwright E2E tests
    └── specs/             # E2E test specifications
```

**Testing Standards:**
- Frontend Tests: Jest + React Testing Library for components and hooks
- E2E Tests: Playwright for critical user flows and PWA functionality
- Test file naming: ComponentName.test.tsx for unit tests
- E2E test naming: feature-name.spec.ts
- All components must have basic rendering tests
- API integration points need mocking strategies for offline testing

**Required Test Coverage:**
- PWA service worker registration and caching
- Supabase client connection and basic queries
- TypeScript compilation without errors  
- Tailwind CSS styling integration
- Next.js routing functionality

### Security and Performance Considerations

**Authentication & Security** [Source: architecture/backend-architecture.md]
- JWT token management through Supabase Auth
- Row Level Security (RLS) policies for family data isolation
- Secure environment variable handling
- CORS configuration for API routes

**Performance Requirements**
- Mobile-first responsive design
- PWA offline functionality
- Optimized bundle size with code splitting
- Fast development rebuild times with Turbopack

## Testing

### Test Location Standards
- Unit tests: `__tests__/` directory alongside source files
- Component tests: `__tests__/components/ComponentName.test.tsx`
- E2E tests: `e2e/specs/feature.spec.ts`

### Testing Frameworks and Patterns
- Jest for unit testing with TypeScript support
- React Testing Library for component testing
- Playwright for E2E testing with PWA support
- Mock Supabase client for unit tests
- Test database setup for integration tests

### Specific Testing Requirements for This Story
- Test Next.js project initialization and basic routing
- Verify PWA manifest and service worker registration
- Test Supabase connection and environment configuration
- Validate TypeScript compilation and type checking
- Test Tailwind CSS integration and responsive design basics
- Verify development server startup and hot reload functionality

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-01 | 1.0 | Initial story creation with architecture context | System |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used

*To be filled by dev agent*

### Debug Log References

*To be filled by dev agent*

### Completion Notes List

*To be filled by dev agent*

### File List

*To be filled by dev agent*

## QA Results

*This section will be populated by the QA Agent after story completion*